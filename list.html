<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <div id="product-cards" class="row"></div>  
        
        <div class="container mt-3">
            <button class="btn btn-danger" id="filter">6만원이하</button>
            <button class="btn btn-danger sort">가격순</button>
            <button class="btn btn-danger" id="more">더보기</button>
            <button class="btn btn-danger" id="shoppingcart">장바구니</button>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
          var products = []; // 제품 배열 초기화
          var allData = []; // 모든 데이터를 저장할 배열

        function 상품목록(productArray) {
            var cardGroup = document.getElementById('product-cards');
        
            productArray.forEach(product => {
                var card = document.createElement('div');
                card.className = 'col-4 mb-4';  // 카드가 3열로 배치되도록 설정
                card.innerHTML = `
                    <div class="card h-100">
                        <img src="https://via.placeholder.com/600" class="card-img-top">
                        <div class="card-body">
                            <h5 class="card-title" id='cardtitle'>${product.title}</h5>
                            <p class="card-text">상품명: ${product.title}</p>
                            <p class="card-text">가격: ${product.price}원</p>
                            <button class="btn btn-danger buy">구매하기</button>
                        </div>
                    </div>
                `;
                cardGroup.appendChild(card);
            });
        }

        // 초기 제품 카드 생성
        var clickCount = 0;

        function 데이터() {
            $.get('https://hjw1191.github.io/data//data.json')
            .done((data) => {
                allData = data; // 모든 데이터를 저장
                초기제품(); // 첫 번째 데이터 배치를 로드
            });
        }

        function 초기제품() {
            var start = clickCount * 3;
            var end = start + 3;
            var currentBatch = allData.slice(start, end);
                
                if (currentBatch.length > 0) {
                    상품목록(currentBatch);
                    clickCount++;
                }

                if (clickCount >= 3) {
                    $('#more').hide();  // 더 이상 불러올 데이터가 없으면 버튼 숨기기
                }
            }

        // 초기 데이터 로드
        데이터();

        $('#more').click(function(){
            초기제품();
        });
      
        $(".sort").click(function(){
            $('#product-cards').html('') // 내용초기화
            allData.sort(function(a,b){
                return a.price-b.price;
            });
            상품목록(allData.slice(0, clickCount * 3));
        })
        
     

        $('#filter').click(function(){
             
        var newProduct = allData.filter(function(a){
            return a.price <= 60000
        });
        $('#product-cards').html('');
        상품목록(newProduct.slice(0, clickCount * 3));
        });


    $(document).on('click', '.buy', function() {
    var productTitle = $(this).siblings('h5').text(); // 
    var cart = localStorage.getItem('cart'); // 기존의 cart 데이터를 로드
    // cart가 존재하면 JSON 파싱, 존재하지 않으면 빈 배열로 초기화
    cart = cart ? JSON.parse(cart) : [];
    // 새로운 제품 제목을 장바구니 배열에 추가
    cart.push(productTitle);
    // 업데이트된 배열을 다시 JSON 문자열로 변환하여 로컬 스토리지에 저장
    localStorage.setItem('cart', JSON.stringify(cart));
    console.log(cart);
    });

    $('#shoppingcart').click(function(){
     var cart = localStorage.getItem('cart');
     $('#product-cards').html('');
     var cartProducts = allData.filter(product => cart.includes(product.title));
     상품목록(cartProducts);
    })
    </script> 
</body>
</html>
